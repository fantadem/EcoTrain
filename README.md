# R√©duction de l'impact environnemental des plateformes de r√©servation de trains 

## Choix du sujet
On utilise presque tous le site ou l‚Äôapplication de la SNCF pour regarder un horaire ou acheter un billet. C‚Äôest devenu un r√©flexe du quotidien, un service que beaucoup consid√®rent comme indispensable, surtout quand on sait que 122 millions de voyageurs ont pris le TGV en 2023. On parle souvent du train comme d‚Äôun moyen de transport √©cologique, mais on oublie que tout commence en ligne. 
Est-ce que l‚Äôoutil num√©rique qu‚Äôon utilise pour voyager est vraiment aussi ¬´ vert ¬ª qu‚Äôon le pense ? 
M√™me si tout para√Æt immat√©riel, chaque clic consomme de l‚Äô√©nergie. Notre objectif est donc simple : mesurer l‚Äôimpact environnemental de l‚Äôapplication web de la SNCF, pour voir si la face num√©rique du train est aussi propre que ses rails. 
  
## Utilit√© sociale
### Des transports longue distance
Les transports longue distance, comme ceux propos√©s par la SNCF, sont bien plus qu‚Äôun simple moyen de se d√©placer : ils contribuent directement √† une mobilit√© plus durable et accessible pour tous.

**Acc√®s √† l‚Äôemploi** : par exemple, un habitant de Romilly peut travailler √† Troyes ou m√™me √† Paris gr√¢ce aux liaisons ferroviaires r√©guli√®res. Sans ces trajets, certaines carri√®res seraient tout simplement impossibles.

**Acc√®s aux services publics** : sant√©, √©ducation, administration‚Ä¶ tout devient plus atteignable, m√™me quand on vit loin des grandes villes.

**Lien entre les territoires** : le train connecte des r√©gions parfois isol√©es, cr√©ant un sentiment d‚Äôappartenance nationale.

**Outil de d√©centralisation** : il rend moins n√©cessaire de vivre dans les grandes m√©tropoles pour avoir les m√™mes opportunit√©s.

### Des applications (SNCF Connect)
Les applications ne sont pas n√©cessaires √† l'emploi des solutions de transport. En revanche, elles contribuent fortement √† la simplification des d√©marches :
- Planification simplifi√©e
- Visibilit√© des offres de r√©duction
- Acc√®s aux informations (horaires)
- Achat des billets
- Meilleure compr√©hension et gain de temps

Ces applications permettent de favoriser l'acc√®s √† l'information. Dans le cas de SNCF connect par exemple, c'est √©galement un parcours utilisateur qui a enti√®rement √©t√© repens√© ces derni√®res ann√©es pour le simplifier, et am√©liorer l'aisance d'utilisation.

En somme, les applications permettent une plus forte fr√©quentation des services, gr√¢ce √† la facilitation des d√©marches li√©es aux d√©placements longue distance

## Effets de la num√©risation
Les applications num√©riques de la SNCF remplacent en partie les billets papier achet√©s au guichet ainsi que les informations affich√©es en gare. Ces alternatives ¬´ physiques ¬ª existent toujours, mais elles sont d√©sormais utilis√©es en solution de secours, plut√¥t qu‚Äôen premier r√©flexe.

Par exemple, de nombreuses gares ont r√©duit leurs horaires d‚Äôouverture ou ferm√© certains guichets, obligeant les usagers √† passer par l‚Äôapplication ou les bornes automatiques. Dans certaines petites gares, il n‚Äôy a m√™me plus aucun personnel sur place : sans smartphone ou connexion Internet, acheter un billet devient un v√©ritable parcours du combattant.

## Sc√©narios d'usage et impacts
Nous imaginons deux sc√©narios d'utilisation des applications de r√©servation de trains : l'achat d'un billet de train et la consultation de son billet. D'autres sc√©narios peuvent √™tre envisag√©s, comme la consultation des horaires, mais ce sc√©nario ressemble fortement au sc√©nario de r√©servation de billet.

### Sc√©nario 1 : "Achat d'un billet de train"
1. L'utilisateur renseigne ses gares de d√©part et de destination, ainsi que la date du voyage.
2. Ensuite, il s√©lectionne le voyage de son choix parmi ceux propos√©s.
3. Puis il s√©lectionne les options de son voyage (seconde ou premi√®re classe, option v√©lo, si√®ge)
4. Enfin, il valide le voyage et passe au paiement

### Sc√©nario 2 : "Consultation de billets de train"
1. L'utilisateur se connecte √† son espace.
2. Il s√©lectionne le voyage √† venir concern√©.
3. Il acc√®de au billet, et peut par exemple le t√©l√©charger.


## Impact de l'ex√©cution du sc√©nario aupr√®s de diff√©rents services concurrents
L'EcoIndex d'une page (de A √† G) est calcul√© (sources : EcoIndex, Octo, GreenIT) en fonction du positionnement de cette page parmi les pages mondiales concernant :
- le nombre de requ√™tes lanc√©es,
- le poids des t√©l√©chargements,
- le nombre d'√©l√©ments du document.

Nous avons choisi de comparer l'impact des sc√©narios sur les plateformes de r√©servation de train de divers pays, appartenant √† des compagnies ou non (SNCF Connect, Deutsche Bahn, 1.2.Train, Omio, Eurostar)

|Service|Score (sur 100)|Classe|D√©tail des mesures|
|---|---|---|---|
|SNCF Connect| 23  | F üî¥  | [...](https://github.com/UTT-GL03/EcoTrain/blob/main/benchmark/SNCF%20Connect/declaration-environnementale.md)  |
|DB| 32 | E üü† | [...](https://github.com/UTT-GL03/EcoTrain/blob/main/benchmark/Deutsche%20Bahn/declaration-environnementale.md)  | 
|1.2.Train|82|  A üîµ | [...](https://github.com/UTT-GL03/EcoTrain/blob/main/benchmark/1.2.Train/declaration-environnementale.md)  | 
|Omio| 40  | D üü°  | [...](https://github.com/UTT-GL03/EcoTrain/blob/main/benchmark/Omio/declaration-environnementale.md)  | 
|Eurostar| 15  | F üî¥ | [...](https://github.com/UTT-GL03/EcoTrain/blob/main/benchmark/Eurostar/declaration-environnementale.md)  | 

__Tab.1__ : Mesure de l'EcoIndex moyen de divers services de r√©servation de trains.

Les mesures de l'impact moyen de ces services (cf. Tab.1) r√©v√®lent des classes EcoIndex tr√®s faibles pour la plupart (D √† F). Seule la solution 1.2.Train, ind√©pendante des compagnies, se d√©marque avec un score √©lev√© (A). Cela peut s'expliquer par la structure tr√®s simple du site.

## Mod√®le √©conomique
Comme nous l'avons vu dans la section pr√©c√©dente, parmi les choix de conception ayant le plus d'impact environnemental, la plupart sont directement li√©s au mod√®le √©conomique du service. C'est pourquoi il est n√©cessaire √† ce stade d'analyser leur mod√®le √©conomique et de d√©finir notre propre mod√®le permettant une conception plus frugale. 

|Service|Source de revenus|
|---|---|
|SNCF Connect|Vente de billets|
|DB|Vente de billets|
|1.2.Train|Commissions|
|Omio|Commissions|
|Eurostar|Vente de billets|

__Tab.2__ : Offre des services de r√©servation de billets de train.

Notre march√© semble √™tre structur√© en oligop√¥le : il y a plusieurs offreurs pour acheter le m√™me billet de train. Le billet vendu est le m√™me sur les diff√©rentes plateformes mais ces plateformes ne sont pas enti√®rement identiques : fluidit√©, interface, exp√©rience utilisateur. Les services de r√©servation sont substituables entre eux : si l'on ne souhaite pas acheter son billet de train sur SNCF Connect, on peut l'acheter sur 1.2.Train ou sur Omio.

1.2.Train dispose d'un mod√®le √©conomique fragile qu'il serait pertinent de renforcer, mais le site web est d√©j√† suffisamment sobre pour que l'on ne se penche pas sur ce cas dans le cadre de notre projet. Nous trvavaillerons donc sur SNCF Connect. Il n'y a pas de publicit√© sur la plateforme, qui semble uniquement se financer gr√¢ce aux revenus des ventes de billets de train (service annexe). Nous voyons donc peu d'autres mod√®les √©conomiques pertinents, sachant que celui-ci semble largement viable.

|Source possible de revenus|Montant unitaire|Quantit√© n√©cessaire pour financer un salaire[^1]|
|---|---|---|
|Part sur les ventes de billets[^2]|0,90‚Ç¨|3966|

[^1]: Bas√© sur le co√ªt total employeur du salaire m√©dian 2025 soit 3569‚Ç¨ environ (source : [URSSAF](https://mon-entreprise.urssaf.fr/simulateurs/salaire-brut-net))
[^2]: Estimation sur la base de 2% des billets d√©di√©e √† la plateforme, les billets √©tant √† 45‚Ç¨ en moyenne

## Maquette de l'interface et √©chantillon de donn√©es
Au vu des diff√©rents services compar√©s, des exigences environnementales exprim√©es plus haut et des sc√©narios retenus, nous avons d√©fini pour notre prototype une maquette de l'interface et un √©chantillon de donn√©es r√©alistes.

Les ressources Web poss√©dant une repr√©sentation sur notre application seront de deux types :
- Les r√©sultats de recherche de voyage (avec une HTTP-URI ayant pour chemin /?depart={gare_depart}&arrivee={gare_arrivee}&date={date})
- Un voyage propos√© (avec une HTTP-URI ayant pour chemin /{id})
  
<img src="./docs/mockup_search.JPG" alt="maquette de la page de recherche" height="500"/>   <img src="./docs/mockup_tripdetails.JPG" alt="maquette de la page de r√©sultats" height="500"/>


__Fig.1__: Maquette de la page de recherche // __Fig.2__: Maquette de la page de r√©sultats de recherche

Dans un objectif de sobri√©t√© environnementale, les r√©sultats de recherche se limiterons √† ceux du jour s√©lectionn√©.

Pour des raisons de respect des droits d'auteurs, nous utilisons des donn√©es g√©n√©r√©es (avec [dummy-json](https://dummyjson.com/)). Bien que fictives, ces donn√©es correspondent √† la structure des services concurrents : les voyages comportent une gare de d√©part et d'arriv√©e, une date, une heure de d√©part et d'arriv√©e, et un ou plusieurs tarifs.

## Impl√©mentation du sc√©nario prioritaire

### Prototypage : Fonctionnalit√©s pour le sc√©nario prioritaire avec donn√©es charg√©es de mani√®re statique
Pour cette premi√®re version du prototype (v1.0.0):
- l'√©chantillon de donn√©es est encore charg√© dans le code de mani√®re statique,
- les fonctionnalit√©s impl√©ment√©es ne sont que celles n√©cessaires pour suivre le sc√©nario prioritaire ("Acheter un billet de train").

Ce sc√©nario n√©cessite de pouvoir naviguer entre plusieurs pages : 
- la page de recherche de voyage, o√π il est possible de rechercher des trajets
- la page de r√©sultats, o√π s'affichent les trajets correspondant aux crit√®res
- la page de d√©tails du trajet, une fois celui-ci s√©lectionn√©
- le panier, avant de passer au paiement du ou des billet(s)

### Page de recherche de voyage
La page d'accueil renvoie un formulaire permettant de renseigner ses crit√®res de recherche de voyage.

<img src="./docs/searchpage_screenshot.png" alt="prototype de la page de recherche" width="800"/>

__Fig.3__ : Prototype de la page de recherche de voyage

Pour l'instant, nous avons choisi un framework de mise en page minimaliste (PicoCSS). Dans la suite du projet, nous verrons si l'impact environnemental du passage √† un framework de mise en page plus puissant (comme Bootstrap) est acceptable.

Nous avons √©galement fait le choix de ne pas inclure de photographies, celles-ci n'√©tat pas n√©cessaires √† la r√©servation d'un billet de train.

Dans l'√©tat actuel du prototype, il est possible d'avoir une premi√®re id√©e de l'impact environnemental du frontend. Bien entendu, il manque encore le chargement dynamique des donn√©es, mais nous pouvons d√©j√† √©valuer l'impact de l'affichage des donn√©es et du framework (au sens large : React, PicoCSS). Cette √©valuation de l'impact (cf. Tab.3) est d√©j√† encourageante en mode "d√©veloppement" mais encore plus en mode "pr√©-production". Nous mesurons ici l'effet positif de l'adoption d'outils de d√©veloppement Web int√©grant la ["minification"](https://fr.wikipedia.org/wiki/Minification) (cf. Wikip√©dia) du code et la concat√©nation du code d'une part et des feuilles de style d'autre part.

| |EcoIndex|GES (gCO2e)|Taille du DOM|Requ√™tes|Taille de la page (ko)|
|---|---|---|---|---|---|
|Mode "d√©veloppement"|79 B üü¢ |1.42|81|29|1873|
|Mode "pr√©-production"|91 A üîµ|1.18|78|6|145|

__Tab.3__ Mesure de l'EcoIndex moyen de notre prototype, dans le cadre du sc√©nario n¬∞1

### Page de r√©sultats de recherche

La page de r√©sultats de recherche a pour HTTP-URI /trips, et affiche actuellement l'ensemble des donn√©es factices de fa√ßon statique. √Ä plus long terme, une requ√™te GET sera ajout√©e √† la suite de /trips afin d'afficher dynamiquement les r√©sultats selon les informations renseign√©es dans le formulaire de la page pr√©c√©dente.

Depuis cette page, il est possible d'acc√©der aux d√©tails de l'un des trajets afin de le r√©server, ou bien de retourner √† la page d'accueil en cliquant sur le titre de la page ("EcoTrain").

<img src="./docs/tripslist_screenshot.png" alt="prototype de la page de r√©sultats de recherche" width="800"/>

__Fig.4__ Prototype de la page de r√©sultats de recherche

### Page de d√©tails du trajet

Les pages des voyages ont pour HTTP-URI /trips/{id}. Dans notre jeu de donn√©es, chaque voyage dispose d'un ID unique qui est r√©employ√© dans l'URI.

De m√™me que pr√©c√©demment, nous avons tent√© d'impl√©menter cette page (cf. Fig. 4) conform√©ment √† ce que pr√©voyait la maquette.

<img src="./docs/tripdetails_screenshot.png" alt="prototype de la page de d√©tails sur le trajet s√©lectionn√©" width="800"/>


__Fig.5__ Prototype de la page de d√©tails sur le trajet choisi

### Page du panier

<img src="./docs/cart_screenshot.png" alt="prototype de la page du panier" width="800"/>

__Fig.6__ : Prototype de la page du panier


### Impacts du sc√©nario prioritaire (v1.0.0)

| |EcoIndex|GES (gCO2e)|Taille du DOM|Requ√™tes|Taille de la page (ko)|
|---|---|---|---|---|---|
|1. Renseigner les crit√®res de recherche pour son trajet |91 A üîµ|1.18|78|6|145|
|2. Consulter les trajets disponibles, et s√©lectionner celui de son choix|75 B üü¢ |1.50|43|6|145|
|3. Consulter les d√©tails d'un trajet et l'ajouter au panier|94 A üîµ|1.12|47|6|145|
|4. Consulter son panier et acc√©der au paiement|94 A üîµ|1.13|43|6|145|

__Tab.4__: √âvaluation de l'impact du sc√©nario "Achat d'un billet de train" dans le prototype n¬∞1 (v1.0.0)

### Prototypage : Donn√©es statiques charg√©es de mani√®re dynamique (v1.0.1)

Pour cette nouvelle version du prototype (v1.0.1), identique du point de vue fonctionnel, les donn√©es (toujours statiques) sont d√©sormais charg√©es par le frontend √† travers le r√©seau imm√©diatement apr√®s un premier affichage √† vide. Ce comportement, plus r√©aliste, n'a pour effet qu'une requ√™te suppl√©mentaire par page affich√©e.

Concernant l'√©valuation de l'impact environnemental du sc√©nario, par rapport au tableau pr√©c√©dent (cf. Tab.2), √† l'exception du nombre de requ√™tes qui augmente l√©g√®rement, les r√©sultats sont identiques.

| |EcoIndex|GES (gCO2e)|Taille du DOM|Requ√™tes|Taille de la page (ko)|
|---|---|---|---|---|---|
|1. Renseigner les crit√®res de recherche pour son trajet |91 A üîµ |1.18|81|6|146|
|2. Consulter les trajets disponibles, et s√©lectionner celui de son choix |75 B üü¢|1.51|501|9|146|
|3. Consulter les d√©tails d'un trajet et l'ajouter au panier|93 A üîµ|1.14|47|9|146|
|4. Consulter son panier et acc√©der au paiement|93 A üîµ|1.14|43|10|146|

__Tab.5__: √âvaluation de l'impact du sc√©nario "Achat d'un billet de train", dans la version 1.0.1


## Mesures de la consommation √©nerg√©tique lors du passage √† l'√©chelle

Maintenant que notre prototype est r√©aliste en termes de nombre de requ√™tes, nous pouvons simuler les effets du "passage √† l'√©chelle". 

Dans le cas des plateformes de trains et des fonctionnalit√©s pr√©vues (consultation des voyages, achat de billet), l'augmentation de la quantit√© des donn√©es √† traiter pourrait provenir de la conservation de trajets pass√©s dans la base de donn√©es, ainsi que des billets de voyages pass√©s.
√Ä raison de 15.000 trains circulant sur le r√©seau ferr√© chaque jour, si chacun d'eux effectue un seul trajet, cela augmenterait notre volumes de trajets de 15.000 par jour, soit 450.000 par mois.

Conserver ces donn√©es ne semble pas avoir une utilit√© suffisament importante pour justifier l'impact environnemental qui y serait associ√©. Ainsi, nous ferons le choix de supprimer automatiquement les trajets pass√©s.

De la m√™me fa√ßon, les billets relatifs aux trajets pass√©s ne seront pas conserv√©s.

#### √âvolution de l'EcoIndex lors du passage √† l'√©chelle

Produites d√©sormais de mani√®re automatique lors de l'int√©gration continue, les mesures n√©cessaires √† la production de l'EcoIndex, [avant](https://github.com/UTT-GL03/EcoTrain/actions/runs/19293859455/artifacts/4541500392) et [apr√®s](https://github.com/UTT-GL03/EcoTrain/actions/runs/19298418224/artifacts/4543202028) la simulation du passage √† l'√©chelle retraduisent bien (cf. Tab.6) l'augmentation du poids des t√©l√©chargements, mais aussi de l'augmentation du nombre d'√©l√©ments de la page des titres.

Afin que la mesure puisse √™tre effectu√©e dans des d√©lais raisonnables, nous avons fait le choix de n'augmenter le nombre de voyages que d'un facteur 100 1500

|   | EcoIndex| GES (gCO2e) | Taille du DOM | Requ√™tes | Taille de la page (ko)
|---|--------:|------------:|--------------:|---------:|---------------------:
| 1. Renseigner les crit√®res de recherche pour son trajet | 84 A üîµ | 1,3 | 89 | <del>7</del><br/>6 | <del>430</del><br/>431
| 2. Lancer la recherche et consulter les trajets disponible, et s√©lectionner celui de son choix | <del>55 C üîµ</del><br/>50 D üü° | <del>1,9</del><br/>2,1 | <del>972</del><br/>1771 | 1 | <del>470</del><br/>470
| 3. Selectionner son trajet | <del>87 A üîµ</del><br/>86 A üîµ | <del>1,3</del><br/>1,3 | 57 | 1 | <del>470</del><br/>761
| 4. Consulter les d√©tails du trajet, | <del>92 A üîµ</del><br/>87 A üîµ |  <del>1,2</del><br/>1,3 | 50 | 0 | <del>0</del><br/>761
| 5. Consulter son panier et acc√©der au paiement | <del>88 A üîµ</del><br/>87 A üîµ |  <del>1,2</del><br/>1,3 | 50 | 1 | <del>0</del><br/>761

__Tab.6__: Effet du passage √† l'√©chelle sur l'impact du sc√©nario "Achat d'un billet de train" dans le prototype v1.0.1.

On constate que la baisse de l'EcoIndex est la plus importante √† l'affichage des r√©sultats de recherche. Cela semble coh√©rent puisque c'est sur cette page qu'un grand nombre d'√©l√©ments (propositions de voyage de la base de donn√©es) va appara√Ætre.

Pour √©valuer plus pr√©cis√©ment l'impact de la consultation des d√©tails d'un trajet, nous utiliserons un autre outil de mesure : GreenFrame.

### Mesure de la consommation √©nerg√©tique li√©e √† la consultation

Le logiciel GreenFrame est capable d'estimer, pour les diff√©rents composants de l'architecture, la consommation √©nerg√©tique :

- du CPU (√† partir du temps de calcul),
- de la m√©moire vive (√† partir de la taille des donn√©es m√©moris√©es),
- du disque (√† partir de la taille des donn√©es lues et √©crites),
- du r√©seau (√† partir de la taille des donn√©es re√ßues et envoy√©es),
- pour le navigateur uniquement, de l'√©cran (√† partir du temps d'ex√©cution du sc√©nario).


|   (a)  Consultation de la page d‚Äôaccueil               | cpu (Wh)   | mem (Wh)   | disk (Wh) | network (Wh)       | screen (Wh) | total (Wh)   |
| ------------------ | ---------- | ---------- | --------- | ------------------ | ----------- | ------------ | 
| Navigateur         | 0.0018     | 0.00015   | 0.0       | <mark>0.026</mark> | <mark>0.069</mark> | 0.073  |
| Serveur Web        | 0.000022   | 0.0000075   | 0.0       | <mark>0.019</mark> | 0.0                | 0.020 |

#### Total : 0.075 Wh (75.211 mWh), soit 33.243 mg CO‚ÇÇe ¬± 3.2%


| (b) Consultation des r√©sultats de recherche               | cpu (Wh)   | mem (Wh)   | disk (Wh) | network (Wh)       | screen (Wh)        | total (Wh) |
| ------------------ | ---------- | ---------- | --------- | ------------------ | ------------------ | ---------- | 
| Navigateur         | 0.0012     |  0.000079  |  0.0      | <mark>0.0058</mark> | <mark>0.082</mark> |  0.99      |
| Serveur Web        | 0.000026   |  0.0000089  |  0.0      | <mark>0.045</mark> | 0.0                |  0.0046     |

#### Total : 0.104 Wh (103.932 mWh), soit 45.938 mg CO‚ÇÇe ¬± 1.6%

__Tab.7__: Estimation de la consommation √©nerg√©tique de la page d'accueil (premier tableau) et de la consultation des trajets affich√©s (second tableau).

Par rapport √† ce que pouvait laisser penser une simple analyse par l‚ÄôEcoIndex, les r√©sultats obtenus avec GreenFrame montrent que la consultation de la page d‚Äôaccueil et la consultation des r√©sultats de recherche pr√©sentent des impacts √©nerg√©tiques relativement proches : 0.075 Wh pour l‚Äôaccueil et 0.104 Wh pour la page de r√©sultats (cf. tableau).
Autrement dit, m√™me si la page de r√©sultats contient davantage d‚Äôinformations √† afficher, l‚Äôimpact li√© au rendu de l‚Äôinterface reste largement domin√© par d‚Äôautres composants, notamment le navigateur lui-m√™me.

Les mesures indiquent en effet que l‚Äôaffichage dans le navigateur (√©nergie √©cran) constitue la part la plus importante de l‚Äôempreinte, devant la consommation CPU ou m√©moire. Le co√ªt total du serveur web, quant √† lui, reste tr√®s faible : dans les deux sc√©narios, il n‚Äôatteint que quelques milli-Wh, ce qui montre que le poids √©nerg√©tique principal ne provient pas du backend, mais bien de l‚Äôex√©cution du sc√©nario dans le navigateur utilisateur.

Un autre r√©sultat int√©ressant est que la transmission des donn√©es sur le r√©seau reste un poste significatif. Dans nos sc√©narios, la consommation r√©seau du navigateur et du serveur repr√©sente une contribution non n√©gligeable √† l‚Äôempreinte totale, notamment pour la page de r√©sultats qui implique plus de r√©ponses HTTP.

En r√©sum√©, les trois composantes ayant le plus d‚Äôimpact (√† peu pr√®s √† √©galit√©, les autres √©tant n√©gligeables) sont :

l‚Äô√©cran du client (screen Wh, fortement influenc√© par la dur√©e du sc√©nario),

le r√©seau c√¥t√© client,

le r√©seau c√¥t√© serveur.

Ce r√©sultat confirme que l‚Äôoptimisation la plus pertinente pour les prochaines √©tapes ne concerne pas seulement l‚Äôam√©lioration du code frontend, mais surtout la r√©duction du volume et de la fr√©quence des donn√©es transmises, ce que permettra l‚Äôintroduction de CouchDB et du filtrage c√¥t√© serveur.

## Impact de l'introduction d'une base de donn√©es

Afin de r√©duire l'impact √©nerg√©tique du r√©seau, nous stockons d√©sormais les donn√©es de l'application (v2.0.0) dans une base de donn√©es (*CouchDB*). Cette √©volution nous permet, lors de l'affichage des r√©sultats de recherche, de filtrer les trajets c√¥t√© serveur au lieu de charger l'int√©gralit√© des donn√©es dans le navigateur.

### Sc√©nario (a) : Consultation de la page d'accueil

|                    | cpu (s)   | screen (s) | mem (B)   | disk (B) | network (B) |
|--------------------|-----------|------------|-----------|----------|-------------|
| Navigateur Web     | 0,148     | 17,3       | 1,26e+8   | 0,00     | 5,02e+5     |
| Serveur Web        | 0,000283  | 0,00       | 5,56e+6   | 0,00     | 3,80e+5     |
| Base de donn√©es    | 0,0953    | 0,00       | 1,17e+8   | 0,00     | 26,0        |

### Sc√©nario (b) : Consultation des r√©sultats de recherche

|                    | cpu (s)   | screen (s) | mem (B)   | disk (B) | network (B) |
|--------------------|-----------|------------|-----------|----------|-------------|
| Navigateur Web     | 0,879     | 21,4       | 1,67e+8   | 0,00     | 1,30e+6     |
| Serveur Web        | 0,000294  | 0,00       | 5,96e+6   | 0,00     | 3,80e+5     |
| Base de donn√©es    | 0,184     | 0,00       | 1,17e+8   | 0,00     | 6,48e+5     |

### Sc√©nario (c) : Consultation des d√©tails d'un trajet

|                    | cpu (s)   | screen (s) | mem (B)   | disk (B) | network (B) |
|--------------------|-----------|------------|-----------|----------|-------------|
| Navigateur Web     | 0,125     | 17,6       | 1,27e+8   | 0,00     | 5,06e+5     |
| Serveur Web        | 0,000261  | 0,00       | 5,96e+6   | 0,00     | 3,80e+5     |
| Base de donn√©es    | 0,0923    | 0,00       | 1,17e+8   | 0,00     | 1,60e+3     |

__Tab.8__ : Effet sur l'utilisation des ressources de l'introduction d'une base de donn√©es dans l'application.

---

| (a)             | cpu (Wh)                          | mem (Wh)                         | disk (Wh) | network (Wh)                     | screen (Wh)              | total (Wh)                   |
|-----------------|-----------------------------------|----------------------------------|-----------|----------------------------------|--------------------------|------------------------------|
| Navigateur      | <del>0,0018</del><br/>0,0018      | <del>0,00015</del><br/>0,000048  | 0,0       | <del>0,026</del><br/>0,0026      | <del>0,069</del><br/>0,067 | <del>0,073</del><br/>0,072 |
| Serveur Web     | <del>0,000022</del><br/>0,0000049 | <del>0,0000075</del><br/>0,0000031 | 0,0     | <del>0,019</del><br/>0,0019      | 0,0                      | <del>0,020</del><br/>0,0020  |
| Base de donn√©es | <del>0</del><br/>0,0017           | <del>0</del><br/>0,000061        | 0,0       | <del>0</del><br/>1,4e-7          | 0,0                      | <del>0</del><br/>0,0017      |

| (b)             | cpu (Wh)                          | mem (Wh)                         | disk (Wh) | network (Wh)                     | screen (Wh)              | total (Wh)                   |
|-----------------|-----------------------------------|----------------------------------|-----------|----------------------------------|--------------------------|------------------------------|
| Navigateur      | <del>0,012</del><br/>0,011        | <del>0,000079</del><br/>0,000077 | 0,0       | <del>0,0058</del><br/>0,0067     | <del>0,082</del><br/>0,083 | <del>0,099</del><br/>0,10  |
| Serveur Web     | <del>0,000026</del><br/>0,0000051 | <del>0,0000089</del><br/>0,0000038 | 0,0     | <del>0,045</del><br/>0,0019      | 0,0                      | <del>0,0046</del><br/>0,0020 |
| Base de donn√©es | <del>0</del><br/>0,0032           | <del>0</del><br/>0,000075        | 0,0       | <del>0</del><br/>0,0033          | 0,0                      | <del>0</del><br/>0,0066      |

| (c)             | cpu (Wh)                          | mem (Wh)                         | disk (Wh) | network (Wh)                     | screen (Wh)              | total (Wh)                   |
|-----------------|-----------------------------------|----------------------------------|-----------|----------------------------------|--------------------------|------------------------------|
| Navigateur      | 0,0016                            | 0,000048                         | 0,0       | 0,0026                           | 0,069                    | 0,073                        |
| Serveur Web     | 0,0000046                         | 0,0000031                        | 0,0       | 0,0019                           | 0,0                      | 0,0020                       |
| Base de donn√©es | 0,0016                            | 0,000061                         | 0,0       | 0,0000087                        | 0,0                      | 0,0017                       |

__Tab.9__ : Effet sur la consommation √©nerg√©tique de l'introduction d'une base de donn√©es dans l'application, lors de la consultation de la page d'accueil (tableau 9.a), des r√©sultats de recherche (tableau 9.b) et des d√©tails d'un trajet (tableau 9.c).

Pour la consultation des d√©tails d'un trajet, cette forte diminution de l'utilisation des ressources r√©seau se traduit par une consommation √©nerg√©tique estim√©e (cf. Tab.9c) quasiment minimale, comparable √† celle de la page d'accueil.

## Limitation du nombre d'√©l√©ments affich√©s
Sur notre plateforme de r√©servation de billets de trains, il n'est pas n√©cessaire de faire appara√Ætre tous les trajets disponibles sur une m√™me page de r√©sultats.
Ayant mis √† disposition la possibilit√© de sp√©cifier les gares de d√©part et d'arriv√©e, ainsi qu'une date et une heure de d√©part, nous ferons le choix de limiter les r√©sultats √† 10 trajets dans un premier temps, tout en laissant la possibilit√© de charger des trajets suivants gr√¢ce √† un bouton en bas de page. √Ä noter qu'il sera √©galement possible de modifier les r√©sultats en changeant l'heure de d√©part pr√©alablement renseign√©e dans la zone de recherche.
Cette strat√©gie permettra √† l'utilisateur de visualiser des r√©sultats correspondant d'abord √† sa recherche, tout en ayant la possibilit√© de modifier cette vue.

<img src="./docs/pagination.png" alt="Chargement progressif (√† la demande) des r√©sultats de recherche" width="700"/>

Fig.7 : Chargement progressif (√† la demande) des r√©sultats de recherche (capture d'√©cran).

|                 | cpu (Wh)                           | mem (Wh)                           | disk (Wh) | network (Wh)                       | screen (Wh)               | total (Wh)                    |
|-----------------|------------------------------------|------------------------------------|-----------|------------------------------------|--------------------------|-----------------------------|
| Navigateur      | <del>0,011</del><br/>0,0029        | <del>0,000077</del><br/>0,000053   | 0,0       | <del>0,0067</del><br/>0,0027       | <del>0,083</del><br/>0,069 | <del>0,10</del><br/>0,075   |
| Serveur Web     | <del>0,0000051</del><br/>0,0000099 | <del>0,0000038</del><br/>0,0000030 | 0,0       | <del>0,0019</del><br/>0,0020       | 0,0                      | <del>0,0020</del><br/>0,0020  |
| Base de donn√©es | <del>0,0032</del><br/>0,0011       | <del>0,000075</del><br/>0,000056   | 0,0       | <del>0,0033</del><br/>0,000029     | 0,0                      | <del>0,0066</del><br/>0,0012  |

Tab.10 : Effet sur la consommation √©nerg√©tique du chargement progressif (√† la demande) lors de la consultation des r√©sultats de recherche.

L'impl√©mentation de la strat√©gie en question (v2.0.1, cf. Fig.7) a produit l'effet attendu (cf. Tab.10) : la consommation √©lectrique a significativement diminu√© avec la r√©duction du nombre de r√©sultats affich√©s, passant de 48.39 mg CO‚ÇÇ √† 34.51 mg CO‚ÇÇ, soit une r√©duction de 28.7%.

Cette am√©lioration provient principalement de la r√©duction du temps d'affichage et du nombre d'√©l√©ments DOM √† traiter par le navigateur. La base de donn√©es consomme d√©sormais 5 fois moins d'√©nergie gr√¢ce au filtrage et √† la limitation des r√©sultats c√¥t√© serveur.

Pour r√©sumer, le passage √† l'√©chelle de 15 √† 1500 trajets disponibles avait entra√Æn√© une augmentation de la consommation √©lectrique. Par des techniques simples de base de donn√©es (s√©lection du document pertinent, projection des attributs n√©cessaires et pagination des r√©sultats), la consommation √©lectrique a √©t√© r√©duite de pr√®s de 30% sur la consultation des r√©sultats de recherche.

En l'√©tat, la consommation √©lectrique est d√©sormais optimis√©e par rapport √† la volum√©trie des trajets disponibles, et √† un niveau o√π la part due au CPU, √† la m√©moire et au r√©seau reste n√©gligeable par rapport √† celle de l'√©cran (qui repr√©sente toujours environ 90% de la consommation totale).

L'enjeu dans les am√©liorations √† venir de l'application sera de veiller √† conserver cette sobri√©t√©.

